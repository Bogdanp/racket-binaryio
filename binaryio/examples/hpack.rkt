#lang racket/base
(require binaryio/bitvector
         binaryio/prefixcode)
(provide hpack-encode-table
         hpack-end-code)

;; Adapted from RFC 7541 (HPACK: Header Compression for HTTP/2),
;; Appendix B (Huffman Code)
;; https://tools.ietf.org/html/rfc7541#appendix-B

(define hpack-encode-table-source
  (list
   #|                                                     code                  |#
   #|                          code as bits                        as hex   len |#
   #|        sym              aligned to MSB                       aligned   in |#
   #|                                                              to LSB   bits|#
   #|       (  0) |#    "1111111111000"                  #|           1ff8  [13]|#
   #|       (  1) |#    "11111111111111111011000"        #|         7fffd8  [23]|#
   #|       (  2) |#    "1111111111111111111111100010"   #|        fffffe2  [28]|#
   #|       (  3) |#    "1111111111111111111111100011"   #|        fffffe3  [28]|#
   #|       (  4) |#    "1111111111111111111111100100"   #|        fffffe4  [28]|#
   #|       (  5) |#    "1111111111111111111111100101"   #|        fffffe5  [28]|#
   #|       (  6) |#    "1111111111111111111111100110"   #|        fffffe6  [28]|#
   #|       (  7) |#    "1111111111111111111111100111"   #|        fffffe7  [28]|#
   #|       (  8) |#    "1111111111111111111111101000"   #|        fffffe8  [28]|#
   #|       (  9) |#    "111111111111111111101010"       #|         ffffea  [24]|#
   #|       ( 10) |#    "111111111111111111111111111100" #|       3ffffffc  [30]|#
   #|       ( 11) |#    "1111111111111111111111101001"   #|        fffffe9  [28]|#
   #|       ( 12) |#    "1111111111111111111111101010"   #|        fffffea  [28]|#
   #|       ( 13) |#    "111111111111111111111111111101" #|       3ffffffd  [30]|#
   #|       ( 14) |#    "1111111111111111111111101011"   #|        fffffeb  [28]|#
   #|       ( 15) |#    "1111111111111111111111101100"   #|        fffffec  [28]|#
   #|       ( 16) |#    "1111111111111111111111101101"   #|        fffffed  [28]|#
   #|       ( 17) |#    "1111111111111111111111101110"   #|        fffffee  [28]|#
   #|       ( 18) |#    "1111111111111111111111101111"   #|        fffffef  [28]|#
   #|       ( 19) |#    "1111111111111111111111110000"   #|        ffffff0  [28]|#
   #|       ( 20) |#    "1111111111111111111111110001"   #|        ffffff1  [28]|#
   #|       ( 21) |#    "1111111111111111111111110010"   #|        ffffff2  [28]|#
   #|       ( 22) |#    "111111111111111111111111111110" #|       3ffffffe  [30]|#
   #|       ( 23) |#    "1111111111111111111111110011"   #|        ffffff3  [28]|#
   #|       ( 24) |#    "1111111111111111111111110100"   #|        ffffff4  [28]|#
   #|       ( 25) |#    "1111111111111111111111110101"   #|        ffffff5  [28]|#
   #|       ( 26) |#    "1111111111111111111111110110"   #|        ffffff6  [28]|#
   #|       ( 27) |#    "1111111111111111111111110111"   #|        ffffff7  [28]|#
   #|       ( 28) |#    "1111111111111111111111111000"   #|        ffffff8  [28]|#
   #|       ( 29) |#    "1111111111111111111111111001"   #|        ffffff9  [28]|#
   #|       ( 30) |#    "1111111111111111111111111010"   #|        ffffffa  [28]|#
   #|       ( 31) |#    "1111111111111111111111111011"   #|        ffffffb  [28]|#
   #|   ' ' ( 32) |#    "010100"                         #|             14  [ 6]|#
   #|   '!' ( 33) |#    "1111111000"                     #|            3f8  [10]|#
   #|   '"' ( 34) |#    "1111111001"                     #|            3f9  [10]|#
   #|   '#' ( 35) |#    "111111111010"                   #|            ffa  [12]|#
   #|   '$' ( 36) |#    "1111111111001"                  #|           1ff9  [13]|#
   #|   '%' ( 37) |#    "010101"                         #|             15  [ 6]|#
   #|   '&' ( 38) |#    "11111000"                       #|             f8  [ 8]|#
   #|   ''' ( 39) |#    "11111111010"                    #|            7fa  [11]|#
   #|   '(' ( 40) |#    "1111111010"                     #|            3fa  [10]|#
   #|   ')' ( 41) |#    "1111111011"                     #|            3fb  [10]|#
   #|   '*' ( 42) |#    "11111001"                       #|             f9  [ 8]|#
   #|   '+' ( 43) |#    "11111111011"                    #|            7fb  [11]|#
   #|   ',' ( 44) |#    "11111010"                       #|             fa  [ 8]|#
   #|   '-' ( 45) |#    "010110"                         #|             16  [ 6]|#
   #|   '.' ( 46) |#    "010111"                         #|             17  [ 6]|#
   #|   '/' ( 47) |#    "011000"                         #|             18  [ 6]|#
   #|   '0' ( 48) |#    "00000"                          #|              0  [ 5]|#
   #|   '1' ( 49) |#    "00001"                          #|              1  [ 5]|#
   #|   '2' ( 50) |#    "00010"                          #|              2  [ 5]|#
   #|   '3' ( 51) |#    "011001"                         #|             19  [ 6]|#
   #|   '4' ( 52) |#    "011010"                         #|             1a  [ 6]|#
   #|   '5' ( 53) |#    "011011"                         #|             1b  [ 6]|#
   #|   '6' ( 54) |#    "011100"                         #|             1c  [ 6]|#
   #|   '7' ( 55) |#    "011101"                         #|             1d  [ 6]|#
   #|   '8' ( 56) |#    "011110"                         #|             1e  [ 6]|#
   #|   '9' ( 57) |#    "011111"                         #|             1f  [ 6]|#
   #|   ':' ( 58) |#    "1011100"                        #|             5c  [ 7]|#
   #|   ';' ( 59) |#    "11111011"                       #|             fb  [ 8]|#
   #|   '<' ( 60) |#    "111111111111100"                #|           7ffc  [15]|#
   #|   '=' ( 61) |#    "100000"                         #|             20  [ 6]|#
   #|   '>' ( 62) |#    "111111111011"                   #|            ffb  [12]|#
   #|   '?' ( 63) |#    "1111111100"                     #|            3fc  [10]|#
   #|   '@' ( 64) |#    "1111111111010"                  #|           1ffa  [13]|#
   #|   'A' ( 65) |#    "100001"                         #|             21  [ 6]|#
   #|   'B' ( 66) |#    "1011101"                        #|             5d  [ 7]|#
   #|   'C' ( 67) |#    "1011110"                        #|             5e  [ 7]|#
   #|   'D' ( 68) |#    "1011111"                        #|             5f  [ 7]|#
   #|   'E' ( 69) |#    "1100000"                        #|             60  [ 7]|#
   #|   'F' ( 70) |#    "1100001"                        #|             61  [ 7]|#
   #|   'G' ( 71) |#    "1100010"                        #|             62  [ 7]|#
   #|   'H' ( 72) |#    "1100011"                        #|             63  [ 7]|#
   #|   'I' ( 73) |#    "1100100"                        #|             64  [ 7]|#
   #|   'J' ( 74) |#    "1100101"                        #|             65  [ 7]|#
   #|   'K' ( 75) |#    "1100110"                        #|             66  [ 7]|#
   #|   'L' ( 76) |#    "1100111"                        #|             67  [ 7]|#
   #|   'M' ( 77) |#    "1101000"                        #|             68  [ 7]|#
   #|   'N' ( 78) |#    "1101001"                        #|             69  [ 7]|#
   #|   'O' ( 79) |#    "1101010"                        #|             6a  [ 7]|#
   #|   'P' ( 80) |#    "1101011"                        #|             6b  [ 7]|#
   #|   'Q' ( 81) |#    "1101100"                        #|             6c  [ 7]|#
   #|   'R' ( 82) |#    "1101101"                        #|             6d  [ 7]|#
   #|   'S' ( 83) |#    "1101110"                        #|             6e  [ 7]|#
   #|   'T' ( 84) |#    "1101111"                        #|             6f  [ 7]|#
   #|   'U' ( 85) |#    "1110000"                        #|             70  [ 7]|#
   #|   'V' ( 86) |#    "1110001"                        #|             71  [ 7]|#
   #|   'W' ( 87) |#    "1110010"                        #|             72  [ 7]|#
   #|   'X' ( 88) |#    "11111100"                       #|             fc  [ 8]|#
   #|   'Y' ( 89) |#    "1110011"                        #|             73  [ 7]|#
   #|   'Z' ( 90) |#    "11111101"                       #|             fd  [ 8]|#
   #|   '[' ( 91) |#    "1111111111011"                  #|           1ffb  [13]|#
   #|   '\' ( 92) |#    "1111111111111110000"            #|          7fff0  [19]|#
   #|   ']' ( 93) |#    "1111111111100"                  #|           1ffc  [13]|#
   #|   '^' ( 94) |#    "11111111111100"                 #|           3ffc  [14]|#
   #|   '_' ( 95) |#    "100010"                         #|             22  [ 6]|#
   #|   '`' ( 96) |#    "111111111111101"                #|           7ffd  [15]|#
   #|   'a' ( 97) |#    "00011"                          #|              3  [ 5]|#
   #|   'b' ( 98) |#    "100011"                         #|             23  [ 6]|#
   #|   'c' ( 99) |#    "00100"                          #|              4  [ 5]|#
   #|   'd' (100) |#    "100100"                         #|             24  [ 6]|#
   #|   'e' (101) |#    "00101"                          #|              5  [ 5]|#
   #|   'f' (102) |#    "100101"                         #|             25  [ 6]|#
   #|   'g' (103) |#    "100110"                         #|             26  [ 6]|#
   #|   'h' (104) |#    "100111"                         #|             27  [ 6]|#
   #|   'i' (105) |#    "00110"                          #|              6  [ 5]|#
   #|   'j' (106) |#    "1110100"                        #|             74  [ 7]|#
   #|   'k' (107) |#    "1110101"                        #|             75  [ 7]|#
   #|   'l' (108) |#    "101000"                         #|             28  [ 6]|#
   #|   'm' (109) |#    "101001"                         #|             29  [ 6]|#
   #|   'n' (110) |#    "101010"                         #|             2a  [ 6]|#
   #|   'o' (111) |#    "00111"                          #|              7  [ 5]|#
   #|   'p' (112) |#    "101011"                         #|             2b  [ 6]|#
   #|   'q' (113) |#    "1110110"                        #|             76  [ 7]|#
   #|   'r' (114) |#    "101100"                         #|             2c  [ 6]|#
   #|   's' (115) |#    "01000"                          #|              8  [ 5]|#
   #|   't' (116) |#    "01001"                          #|              9  [ 5]|#
   #|   'u' (117) |#    "101101"                         #|             2d  [ 6]|#
   #|   'v' (118) |#    "1110111"                        #|             77  [ 7]|#
   #|   'w' (119) |#    "1111000"                        #|             78  [ 7]|#
   #|   'x' (120) |#    "1111001"                        #|             79  [ 7]|#
   #|   'y' (121) |#    "1111010"                        #|             7a  [ 7]|#
   #|   'z' (122) |#    "1111011"                        #|             7b  [ 7]|#
   #|   '{' (123) |#    "111111111111110"                #|           7ffe  [15]|#
   #|       (124) |#    "11111111100"                    #|             7fc  [11]|#
   #|   '}' (125) |#    "11111111111101"                 #|           3ffd  [14]|#
   #|   '~' (126) |#    "1111111111101"                  #|           1ffd  [13]|#
   #|       (127) |#    "1111111111111111111111111100"   #|        ffffffc  [28]|#
   #|       (128) |#    "11111111111111100110"           #|          fffe6  [20]|#
   #|       (129) |#    "1111111111111111010010"         #|         3fffd2  [22]|#
   #|       (130) |#    "11111111111111100111"           #|          fffe7  [20]|#
   #|       (131) |#    "11111111111111101000"           #|          fffe8  [20]|#
   #|       (132) |#    "1111111111111111010011"         #|         3fffd3  [22]|#
   #|       (133) |#    "1111111111111111010100"         #|         3fffd4  [22]|#
   #|       (134) |#    "1111111111111111010101"         #|         3fffd5  [22]|#
   #|       (135) |#    "11111111111111111011001"        #|         7fffd9  [23]|#
   #|       (136) |#    "1111111111111111010110"         #|         3fffd6  [22]|#
   #|       (137) |#    "11111111111111111011010"        #|         7fffda  [23]|#
   #|       (138) |#    "11111111111111111011011"        #|         7fffdb  [23]|#
   #|       (139) |#    "11111111111111111011100"        #|         7fffdc  [23]|#
   #|       (140) |#    "11111111111111111011101"        #|         7fffdd  [23]|#
   #|       (141) |#    "11111111111111111011110"        #|         7fffde  [23]|#
   #|       (142) |#    "111111111111111111101011"       #|         ffffeb  [24]|#
   #|       (143) |#    "11111111111111111011111"        #|         7fffdf  [23]|#
   #|       (144) |#    "111111111111111111101100"       #|         ffffec  [24]|#
   #|       (145) |#    "111111111111111111101101"       #|         ffffed  [24]|#
   #|       (146) |#    "1111111111111111010111"         #|         3fffd7  [22]|#
   #|       (147) |#    "11111111111111111100000"        #|         7fffe0  [23]|#
   #|       (148) |#    "111111111111111111101110"       #|         ffffee  [24]|#
   #|       (149) |#    "11111111111111111100001"        #|         7fffe1  [23]|#
   #|       (150) |#    "11111111111111111100010"        #|         7fffe2  [23]|#
   #|       (151) |#    "11111111111111111100011"        #|         7fffe3  [23]|#
   #|       (152) |#    "11111111111111111100100"        #|         7fffe4  [23]|#
   #|       (153) |#    "111111111111111011100"          #|         1fffdc  [21]|#
   #|       (154) |#    "1111111111111111011000"         #|         3fffd8  [22]|#
   #|       (155) |#    "11111111111111111100101"        #|         7fffe5  [23]|#
   #|       (156) |#    "1111111111111111011001"         #|         3fffd9  [22]|#
   #|       (157) |#    "11111111111111111100110"        #|         7fffe6  [23]|#
   #|       (158) |#    "11111111111111111100111"        #|         7fffe7  [23]|#
   #|       (159) |#    "111111111111111111101111"       #|         ffffef  [24]|#
   #|       (160) |#    "1111111111111111011010"         #|         3fffda  [22]|#
   #|       (161) |#    "111111111111111011101"          #|         1fffdd  [21]|#
   #|       (162) |#    "11111111111111101001"           #|          fffe9  [20]|#
   #|       (163) |#    "1111111111111111011011"         #|         3fffdb  [22]|#
   #|       (164) |#    "1111111111111111011100"         #|         3fffdc  [22]|#
   #|       (165) |#    "11111111111111111101000"        #|         7fffe8  [23]|#
   #|       (166) |#    "11111111111111111101001"        #|         7fffe9  [23]|#
   #|       (167) |#    "111111111111111011110"          #|         1fffde  [21]|#
   #|       (168) |#    "11111111111111111101010"        #|         7fffea  [23]|#
   #|       (169) |#    "1111111111111111011101"         #|         3fffdd  [22]|#
   #|       (170) |#    "1111111111111111011110"         #|         3fffde  [22]|#
   #|       (171) |#    "111111111111111111110000"       #|         fffff0  [24]|#
   #|       (172) |#    "111111111111111011111"          #|         1fffdf  [21]|#
   #|       (173) |#    "1111111111111111011111"         #|         3fffdf  [22]|#
   #|       (174) |#    "11111111111111111101011"        #|         7fffeb  [23]|#
   #|       (175) |#    "11111111111111111101100"        #|         7fffec  [23]|#
   #|       (176) |#    "111111111111111100000"          #|         1fffe0  [21]|#
   #|       (177) |#    "111111111111111100001"          #|         1fffe1  [21]|#
   #|       (178) |#    "1111111111111111100000"         #|         3fffe0  [22]|#
   #|       (179) |#    "111111111111111100010"          #|         1fffe2  [21]|#
   #|       (180) |#    "11111111111111111101101"        #|         7fffed  [23]|#
   #|       (181) |#    "1111111111111111100001"         #|         3fffe1  [22]|#
   #|       (182) |#    "11111111111111111101110"        #|         7fffee  [23]|#
   #|       (183) |#    "11111111111111111101111"        #|         7fffef  [23]|#
   #|       (184) |#    "11111111111111101010"           #|          fffea  [20]|#
   #|       (185) |#    "1111111111111111100010"         #|         3fffe2  [22]|#
   #|       (186) |#    "1111111111111111100011"         #|         3fffe3  [22]|#
   #|       (187) |#    "1111111111111111100100"         #|         3fffe4  [22]|#
   #|       (188) |#    "11111111111111111110000"        #|         7ffff0  [23]|#
   #|       (189) |#    "1111111111111111100101"         #|         3fffe5  [22]|#
   #|       (190) |#    "1111111111111111100110"         #|         3fffe6  [22]|#
   #|       (191) |#    "11111111111111111110001"        #|         7ffff1  [23]|#
   #|       (192) |#    "11111111111111111111100000"     #|        3ffffe0  [26]|#
   #|       (193) |#    "11111111111111111111100001"     #|        3ffffe1  [26]|#
   #|       (194) |#    "11111111111111101011"           #|          fffeb  [20]|#
   #|       (195) |#    "1111111111111110001"            #|          7fff1  [19]|#
   #|       (196) |#    "1111111111111111100111"         #|         3fffe7  [22]|#
   #|       (197) |#    "11111111111111111110010"        #|         7ffff2  [23]|#
   #|       (198) |#    "1111111111111111101000"         #|         3fffe8  [22]|#
   #|       (199) |#    "1111111111111111111101100"      #|        1ffffec  [25]|#
   #|       (200) |#    "11111111111111111111100010"     #|        3ffffe2  [26]|#
   #|       (201) |#    "11111111111111111111100011"     #|        3ffffe3  [26]|#
   #|       (202) |#    "11111111111111111111100100"     #|        3ffffe4  [26]|#
   #|       (203) |#    "111111111111111111111011110"    #|        7ffffde  [27]|#
   #|       (204) |#    "111111111111111111111011111"    #|        7ffffdf  [27]|#
   #|       (205) |#    "11111111111111111111100101"     #|        3ffffe5  [26]|#
   #|       (206) |#    "111111111111111111110001"       #|         fffff1  [24]|#
   #|       (207) |#    "1111111111111111111101101"      #|        1ffffed  [25]|#
   #|       (208) |#    "1111111111111110010"            #|          7fff2  [19]|#
   #|       (209) |#    "111111111111111100011"          #|         1fffe3  [21]|#
   #|       (210) |#    "11111111111111111111100110"     #|        3ffffe6  [26]|#
   #|       (211) |#    "111111111111111111111100000"    #|        7ffffe0  [27]|#
   #|       (212) |#    "111111111111111111111100001"    #|        7ffffe1  [27]|#
   #|       (213) |#    "11111111111111111111100111"     #|        3ffffe7  [26]|#
   #|       (214) |#    "111111111111111111111100010"    #|        7ffffe2  [27]|#
   #|       (215) |#    "111111111111111111110010"       #|         fffff2  [24]|#
   #|       (216) |#    "111111111111111100100"          #|         1fffe4  [21]|#
   #|       (217) |#    "111111111111111100101"          #|         1fffe5  [21]|#
   #|       (218) |#    "11111111111111111111101000"     #|        3ffffe8  [26]|#
   #|       (219) |#    "11111111111111111111101001"     #|        3ffffe9  [26]|#
   #|       (220) |#    "1111111111111111111111111101"   #|        ffffffd  [28]|#
   #|       (221) |#    "111111111111111111111100011"    #|        7ffffe3  [27]|#
   #|       (222) |#    "111111111111111111111100100"    #|        7ffffe4  [27]|#
   #|       (223) |#    "111111111111111111111100101"    #|        7ffffe5  [27]|#
   #|       (224) |#    "11111111111111101100"           #|          fffec  [20]|#
   #|       (225) |#    "111111111111111111110011"       #|         fffff3  [24]|#
   #|       (226) |#    "11111111111111101101"           #|          fffed  [20]|#
   #|       (227) |#    "111111111111111100110"          #|         1fffe6  [21]|#
   #|       (228) |#    "1111111111111111101001"         #|         3fffe9  [22]|#
   #|       (229) |#    "111111111111111100111"          #|         1fffe7  [21]|#
   #|       (230) |#    "111111111111111101000"          #|         1fffe8  [21]|#
   #|       (231) |#    "11111111111111111110011"        #|         7ffff3  [23]|#
   #|       (232) |#    "1111111111111111101010"         #|         3fffea  [22]|#
   #|       (233) |#    "1111111111111111101011"         #|         3fffeb  [22]|#
   #|       (234) |#    "1111111111111111111101110"      #|        1ffffee  [25]|#
   #|       (235) |#    "1111111111111111111101111"      #|        1ffffef  [25]|#
   #|       (236) |#    "111111111111111111110100"       #|         fffff4  [24]|#
   #|       (237) |#    "111111111111111111110101"       #|         fffff5  [24]|#
   #|       (238) |#    "11111111111111111111101010"     #|        3ffffea  [26]|#
   #|       (239) |#    "11111111111111111110100"        #|         7ffff4  [23]|#
   #|       (240) |#    "11111111111111111111101011"     #|        3ffffeb  [26]|#
   #|       (241) |#    "111111111111111111111100110"    #|        7ffffe6  [27]|#
   #|       (242) |#    "11111111111111111111101100"     #|        3ffffec  [26]|#
   #|       (243) |#    "11111111111111111111101101"     #|        3ffffed  [26]|#
   #|       (244) |#    "111111111111111111111100111"    #|        7ffffe7  [27]|#
   #|       (245) |#    "111111111111111111111101000"    #|        7ffffe8  [27]|#
   #|       (246) |#    "111111111111111111111101001"    #|        7ffffe9  [27]|#
   #|       (247) |#    "111111111111111111111101010"    #|        7ffffea  [27]|#
   #|       (248) |#    "111111111111111111111101011"    #|        7ffffeb  [27]|#
   #|       (249) |#    "1111111111111111111111111110"   #|        ffffffe  [28]|#
   #|       (250) |#    "111111111111111111111101100"    #|        7ffffec  [27]|#
   #|       (251) |#    "111111111111111111111101101"    #|        7ffffed  [27]|#
   #|       (252) |#    "111111111111111111111101110"    #|        7ffffee  [27]|#
   #|       (253) |#    "111111111111111111111101111"    #|        7ffffef  [27]|#
   #|       (254) |#    "111111111111111111111110000"    #|        7fffff0  [27]|#
   #|       (255) |#    "11111111111111111111101110"     #|        3ffffee  [26]|#
   #|   EOS (256)       "111111111111111111111111111111"          3fffffff  [30]|#
   ))

(define hpack-encode-table
  (list->vector (map string->sbv hpack-encode-table-source)))

(define hpack-end-code
  (string->sbv "111111111111111111111111111111"))
